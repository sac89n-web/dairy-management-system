@page
@model HardwareDataModel

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2><i class="fas fa-database text-primary"></i> Hardware Data Management</h2>
        <p class="text-muted">Manage RFID cards, device configurations, and hardware logs</p>
    </div>
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addCardModal">
        <i class="fas fa-plus"></i> Add RFID Card
    </button>
</div>

<div class="row">
    <!-- RFID Cards -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-id-card"></i> RFID Cards</h5>
            </div>
            <div class="card-body">
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>Card ID</th>
                            <th>Farmer</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach(var card in Model.RfidCards)
                        {
                            <tr>
                                <td>@card.CardId</td>
                                <td>@card.FarmerName (@card.FarmerId)</td>
                                <td>
                                    <span class="badge @(card.IsActive ? "bg-success" : "bg-secondary")">
                                        @(card.IsActive ? "Active" : "Inactive")
                                    </span>
                                </td>
                                <td>
                                    <button class="btn btn-sm btn-warning" onclick="editCard('@card.CardId')">Edit</button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteCard('@card.CardId')">Delete</button>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Hardware Devices -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-microchip"></i> Hardware Devices</h5>
            </div>
            <div class="card-body">
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>Device</th>
                            <th>Port</th>
                            <th>Status</th>
                            <th>Last Connected</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach(var device in Model.HardwareDevices)
                        {
                            <tr>
                                <td>
                                    <i class="fas fa-@(GetDeviceIcon(device.DeviceType))"></i>
                                    @device.DeviceType.ToUpper()
                                </td>
                                <td>@device.PortName</td>
                                <td>
                                    <span class="badge @(device.IsConnected ? "bg-success" : "bg-secondary")">
                                        @(device.IsConnected ? "Connected" : "Disconnected")
                                    </span>
                                </td>
                                <td>
                                    @if(device.LastConnected.HasValue)
                                    {
                                        @device.LastConnected.Value.ToString("dd/MM HH:mm")
                                    }
                                    else
                                    {
                                        <span class="text-muted">Never</span>
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-history"></i> Recent Hardware Sessions</h5>
            </div>
            <div class="card-body">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Session ID</th>
                            <th>Farmer</th>
                            <th>Start Time</th>
                            <th>Duration</th>
                            <th>Weight (kg)</th>
                            <th>Quality</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>S1735467890123</td>
                            <td>राहुल पाटील (F001)</td>
                            <td>29/08/2025 09:15</td>
                            <td>2m 34s</td>
                            <td>15.2</td>
                            <td>FAT: 4.2% | SNF: 8.7%</td>
                            <td><span class="badge bg-success">Completed</span></td>
                        </tr>
                        <tr>
                            <td>S1735467890124</td>
                            <td>सुनील शर्मा (F002)</td>
                            <td>29/08/2025 09:18</td>
                            <td>1m 45s</td>
                            <td>12.8</td>
                            <td>FAT: 3.9% | SNF: 8.4%</td>
                            <td><span class="badge bg-success">Completed</span></td>
                        </tr>
                        <tr>
                            <td>S1735467890125</td>
                            <td>अनिल कुमार (F003)</td>
                            <td>29/08/2025 09:22</td>
                            <td>-</td>
                            <td>8.5</td>
                            <td>Analyzing...</td>
                            <td><span class="badge bg-warning">Active</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Add RFID Card Modal -->
<div class="modal fade" id="addCardModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="post" asp-page-handler="AddCard">
                <div class="modal-header">
                    <h5>Add RFID Card</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Card ID</label>
                        <input type="text" class="form-control" name="cardId" placeholder="CARD001" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Farmer ID</label>
                        <input type="text" class="form-control" name="farmerId" placeholder="F001" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Farmer Name</label>
                        <input type="text" class="form-control" name="farmerName" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Card</button>
                </div>
            </form>
        </div>
    </div>
</div>

@functions {
    string GetDeviceIcon(string deviceType)
    {
        return deviceType.ToLower() switch
        {
            "scale" => "weight",
            "analyzer" => "flask",
            "printer" => "print",
            "rfid" => "id-card",
            _ => "microchip"
        };
    }
}

<script>
function editCard(cardId) {
    alert('Edit card: ' + cardId);
}

function deleteCard(cardId) {
    if(confirm('Delete RFID card: ' + cardId + '?')) {
        // Delete card logic
        alert('Card deleted');
    }
}
</script>