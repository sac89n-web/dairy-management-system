@page "{id:int}"
@model ViewInvoiceModel

<style>
@@media print {
    .no-print, .navbar, .sidebar, .btn, .d-flex.justify-content-between {
        display: none !important;
    }
    
    .card {
        border: none !important;
        box-shadow: none !important;
    }
    
    body {
        margin: 0;
        padding: 20px;
    }
    
    .invoice-header {
        text-align: center;
        margin-bottom: 30px;
        border-bottom: 2px solid #000;
        padding-bottom: 20px;
    }
    
    .invoice-details {
        margin-bottom: 20px;
    }
    
    table {
        width: 100%;
        border-collapse: collapse;
    }
    
    table, th, td {
        border: 1px solid #000;
    }
    
    th, td {
        padding: 8px;
        text-align: left;
    }
    
    .total-section {
        margin-top: 20px;
        float: right;
        width: 300px;
    }
}

@@media screen {
    .print-only {
        display: none;
    }
}
</style>

<div class="d-flex justify-content-between align-items-center mb-4 no-print">
    <h2><i class="fas fa-file-invoice text-primary"></i> Invoice Details</h2>
    <div>
        <a href="/Invoices" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Back to Invoices
        </a>
        <button class="btn btn-primary" onclick="window.print()">
            <i class="fas fa-print"></i> Print
        </button>
    </div>
</div>

<div class="print-only invoice-header">
    <h1>DAIRY MANAGEMENT SYSTEM</h1>
    <p>Milk Collection & Sales Management</p>
    <h2>INVOICE</h2>
</div>

@if(Model.Invoice != null)
{
    <div class="card">
        <div class="card-body">
            <div class="row mb-4 invoice-details">
                <div class="col-md-6">
                    <h4>Invoice #@Model.Invoice.invoice_number</h4>
                    <p><strong>Date:</strong> @Model.Invoice.invoice_date.ToString("dd/MM/yyyy")</p>
                    <p class="no-print"><strong>Status:</strong> 
                        <span class="badge @(Model.Invoice.status == "Paid" ? "bg-success" : Model.Invoice.status == "Pending" ? "bg-warning" : "bg-danger")">
                            @Model.Invoice.status
                        </span>
                    </p>
                </div>
                <div class="col-md-6 text-end">
                    <h5>Bill To:</h5>
                    <p><strong>@Model.Invoice.customer_name</strong></p>
                    <p>@Model.Invoice.customer_contact</p>
                </div>
            </div>

            <table class="table">
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>Quantity</th>
                        <th>Unit Price</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach(var item in Model.InvoiceItems)
                    {
                        <tr>
                            <td>@item.product_name</td>
                            <td>@item.quantity</td>
                            <td>₹@item.unit_price.ToString("N2")</td>
                            <td>₹@item.total_price.ToString("N2")</td>
                        </tr>
                    }
                </tbody>
            </table>

            <div class="row">
                <div class="col-md-6"></div>
                <div class="col-md-6 total-section">
                    <table class="table">
                        <tr>
                            <td><strong>Subtotal:</strong></td>
                            <td class="text-end">₹@Model.Invoice.subtotal.ToString("N2")</td>
                        </tr>
                        <tr>
                            <td><strong>Tax (18%):</strong></td>
                            <td class="text-end">₹@Model.Invoice.tax_amount.ToString("N2")</td>
                        </tr>
                        <tr style="background-color: #f8f9fa;">
                            <td><strong>Total Amount:</strong></td>
                            <td class="text-end"><strong>₹@Model.Invoice.total_amount.ToString("N2")</strong></td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="row mt-4 no-print">
                <div class="col-md-6">
                    <p><strong>Payment Method:</strong> @Model.Invoice.payment_method</p>
                    @if(Model.Invoice.paid_date.HasValue)
                    {
                        <p><strong>Paid Date:</strong> @Model.Invoice.paid_date.Value.ToString("dd/MM/yyyy")</p>
                    }
                </div>
            </div>
            
            <div class="print-only" style="margin-top: 50px; text-align: center; border-top: 1px solid #000; padding-top: 20px;">
                <p><strong>Thank you for your business!</strong></p>
                <p>For any queries, please contact us.</p>
            </div>
        </div>
    </div>
}
else
{
    <div class="alert alert-danger">
        Invoice not found.
    </div>
}