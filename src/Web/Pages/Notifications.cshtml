@page
@model NotificationsModel

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="mb-1"><i class="fas fa-bell text-primary"></i> Notifications</h2>
        <p class="text-muted mb-0">WhatsApp, SMS and email template management</p>
    </div>
    <div>
        <button class="btn btn-primary btn-modern" data-bs-toggle="modal" data-bs-target="#createTemplateModal">
            <i class="fas fa-magic"></i> Create Template
        </button>
    </div>
</div>

<!-- Template Configuration -->
<div class="card card-modern mb-4">
    <div class="card-header bg-transparent border-0">
        <h5 class="mb-0"><i class="fas fa-cog text-primary"></i> Template Configuration</h5>
    </div>
    <div class="card-body">
        <form method="post">
            <div class="row g-3 mb-3">
                <div class="col-md-3">
                    <label class="form-label text-muted small">CHANNEL</label>
                    <select class="form-select" name="channel">
                        <option>WhatsApp</option>
                        <option>SMS</option>
                        <option>Email</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label text-muted small">TEMPLATE</label>
                    <select class="form-select" name="template">
                        <option>Payout Success</option>
                        <option>Collection Receipt</option>
                        <option>Payment Reminder</option>
                        <option>Quality Alert</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label text-muted small">LANGUAGE</label>
                    <select class="form-select" name="language">
                        <option>English</option>
                        <option>हिंदी</option>
                        <option>मराठी</option>
                    </select>
                </div>
                <div class="col-md-3 d-flex align-items-end">
                    <button type="button" class="btn btn-outline-primary btn-modern w-100" onclick="loadTemplate()">
                        <i class="fas fa-download"></i> Load
                    </button>
                </div>
            </div>
            
            <div class="mb-3">
                <label class="form-label text-muted small">MESSAGE TEMPLATE</label>
                <textarea class="form-control" name="message" rows="6" placeholder="Dear {{name}}, your payout of ₹ {{amount}} for {{period}} is processed. Ref {{utr}}.">Dear {{name}}, your payout of ₹ {{amount}} for {{period}} is processed. Ref {{utr}}.</textarea>
                <small class="text-muted">
                    Available variables: {{name}}, {{amount}}, {{period}}, {{utr}}, {{date}}, {{quantity}}, {{rate}}
                </small>
            </div>
            
            <div class="d-flex gap-2">
                <button type="submit" class="btn btn-success btn-modern">
                    <i class="fas fa-save"></i> Save Template
                </button>
                <button type="button" class="btn btn-outline-info btn-modern" onclick="testSend()">
                    <i class="fas fa-paper-plane"></i> Test Send
                </button>
                <button type="button" class="btn btn-outline-warning btn-modern" onclick="previewTemplate()">
                    <i class="fas fa-eye"></i> Preview
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Notification History -->
<div class="card card-modern">
    <div class="card-header bg-transparent border-0">
        <h5 class="mb-0"><i class="fas fa-history text-primary"></i> Recent Notifications</h5>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Time</th>
                        <th>Recipient</th>
                        <th>Channel</th>
                        <th>Template</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>10:30 AM</td>
                        <td>Ramesh Kumar<br><small class="text-muted">9876543210</small></td>
                        <td><span class="badge bg-success"><i class="fab fa-whatsapp"></i> WhatsApp</span></td>
                        <td>Payout Success</td>
                        <td><span class="badge bg-success">Delivered</span></td>
                        <td>
                            <button class="btn btn-outline-primary btn-sm" onclick="viewMessage(1)">
                                <i class="fas fa-eye"></i> View
                            </button>
                        </td>
                    </tr>
                    <tr>
                        <td>10:25 AM</td>
                        <td>Suresh Patil<br><small class="text-muted">9876543211</small></td>
                        <td><span class="badge bg-primary"><i class="fas fa-sms"></i> SMS</span></td>
                        <td>Collection Receipt</td>
                        <td><span class="badge bg-success">Delivered</span></td>
                        <td>
                            <button class="btn btn-outline-primary btn-sm" onclick="viewMessage(2)">
                                <i class="fas fa-eye"></i> View
                            </button>
                        </td>
                    </tr>
                    <tr>
                        <td>10:20 AM</td>
                        <td>Mahesh Singh<br><small class="text-muted">9876543212</small></td>
                        <td><span class="badge bg-info"><i class="fas fa-envelope"></i> Email</span></td>
                        <td>Payment Reminder</td>
                        <td><span class="badge bg-warning">Pending</span></td>
                        <td>
                            <button class="btn btn-outline-primary btn-sm" onclick="viewMessage(3)">
                                <i class="fas fa-eye"></i> View
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Create Template Modal -->
<div class="modal fade" id="createTemplateModal">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-magic"></i> Create New Template</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="createTemplateForm">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Template Name</label>
                            <input type="text" class="form-control" name="templateName" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Category</label>
                            <select class="form-select" name="category">
                                <option>Payment</option>
                                <option>Collection</option>
                                <option>Quality</option>
                                <option>General</option>
                            </select>
                        </div>
                        <div class="col-12">
                            <label class="form-label">Message Content</label>
                            <textarea class="form-control" name="content" rows="5" required></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveTemplate()">Create Template</button>
            </div>
        </div>
    </div>
</div>

<script>
function loadTemplate() {
    // Load selected template
    alert('Template loaded successfully');
}

function testSend() {
    alert('Test message sent to your registered mobile number');
}

function previewTemplate() {
    const message = document.querySelector('textarea[name="message"]').value;
    const preview = message
        .replace('{{name}}', 'Ramesh Kumar')
        .replace('{{amount}}', '12,500')
        .replace('{{period}}', '01-15 Aug 2025')
        .replace('{{utr}}', 'UPI123456789');
    
    alert('Preview:\n\n' + preview);
}

function viewMessage(id) {
    alert('Viewing message details for ID: ' + id);
}

function saveTemplate() {
    alert('Template created successfully');
    location.reload();
}
</script>