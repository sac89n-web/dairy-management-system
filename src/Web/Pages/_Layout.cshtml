@using Microsoft.AspNetCore.Localization
<!DOCTYPE html>
<html lang="@System.Threading.Thread.CurrentThread.CurrentUICulture.TwoLetterISOLanguageName">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Dairy Milk Collection & Sales Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .sidebar { width: 260px; min-height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); position: fixed; top: 0; left: 0; z-index: 1000; transition: transform 0.3s; }
        .sidebar-collapsed { transform: translateX(-100%); }
        .main-content { margin-left: 260px; transition: margin-left 0.3s; }
        .main-content.expanded { margin-left: 0; }
        .nav-item-custom { padding: 12px 20px; margin: 4px 12px; border-radius: 12px; transition: all 0.2s; cursor: pointer; color: rgba(255,255,255,0.8); }
        .nav-item-custom:hover { background: rgba(255,255,255,0.1); color: white; }
        .nav-item-custom.active { background: rgba(255,255,255,0.2); color: white; }
        .metric-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 16px; padding: 24px; margin-bottom: 20px; }
        .metric-card.success { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .metric-card.warning { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .metric-card.info { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .card-modern { border-radius: 16px; border: none; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .btn-modern { border-radius: 12px; padding: 8px 16px; }
        @@media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); }
            .main-content { margin-left: 0; }
            .sidebar.mobile-open { transform: translateX(0); }
        }
    </style>
</head>
<body>
    <!-- Mobile Header -->
    <div class="d-md-none bg-primary text-white p-3 d-flex justify-content-between align-items-center">
        <button class="btn btn-link text-white" onclick="toggleSidebar()">
            <i class="fas fa-bars"></i>
        </button>
        <span class="fw-bold">Dairy Management</span>
        <div></div>
    </div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="p-3 border-bottom border-white border-opacity-25">
            <div class="d-flex align-items-center gap-2 text-white">
                <i class="fas fa-cow fs-4"></i>
                <span class="fw-bold">Dairy Pro</span>
            </div>
        </div>
        <div class="p-2">
            <div class="nav-item-custom" onclick="navigate('/Dashboard')">
                <i class="fas fa-tachometer-alt me-2"></i> Dashboard
            </div>
            <div class="nav-item-custom" onclick="navigate('/WeighingMachine')">
                <i class="fas fa-weight me-2"></i> Milk Collection
            </div>
            <div class="nav-item-custom" onclick="navigate('/MasterData')">
                <i class="fas fa-users me-2"></i> Farmers & Customers
            </div>
            <div class="nav-item-custom" onclick="navigate('/PaymentGateway')">
                <i class="fas fa-wallet me-2"></i> Payouts & Ledger
            </div>
            <div class="nav-item-custom" onclick="navigate('/Sales')">
                <i class="fas fa-receipt me-2"></i> POS & Sales
            </div>
            <div class="nav-item-custom" onclick="navigate('/ColdChain')">
                <i class="fas fa-thermometer-half me-2"></i> Cold Chain / IoT
            </div>
            <div class="nav-item-custom" onclick="navigate('/Invoices')">
                <i class="fas fa-file-text me-2"></i> Compliance (GST)
            </div>
            <div class="nav-item-custom" onclick="navigate('/TankerIntake')">
                <i class="fas fa-truck me-2"></i> Tanker Intake
            </div>
            <div class="nav-item-custom" onclick="navigate('/Reports')">
                <i class="fas fa-chart-line me-2"></i> Reports
            </div>
            <div class="nav-item-custom" onclick="navigate('/MilkCollections')">
                <i class="fas fa-list me-2"></i> Collection Records
            </div>
            <div class="nav-item-custom" onclick="navigate('/RateEngine')">
                <i class="fas fa-calculator me-2"></i> Rate Engine
            </div>
            <div class="nav-item-custom" onclick="navigate('/KYCVerification')">
                <i class="fas fa-shield-check me-2"></i> KYC Verification
            </div>
        </div>
        <div class="mt-4 px-3">
            @{
                var currentCulture = Context.Features.Get<IRequestCultureFeature>()?.RequestCulture?.Culture?.Name ?? "en-IN";
            }
            <select id="languageSelector" class="form-select form-select-sm" onchange="changeLanguage(this.value)">
                <option value="en-IN" selected="@(currentCulture == "en-IN")">English</option>
                <option value="hi-IN" selected="@(currentCulture == "hi-IN")">हिंदी</option>
                <option value="mr-IN" selected="@(currentCulture == "mr-IN")">मराठी</option>
            </select>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <div class="container-fluid p-4">
            @RenderBody()
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('mobile-open');
        }
        function navigate(path) {
            window.location.href = path;
        }
        // Set active nav item
        document.addEventListener('DOMContentLoaded', function() {
            const currentPath = window.location.pathname;
            document.querySelectorAll('.nav-item-custom').forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('onclick')?.includes(currentPath)) {
                    item.classList.add('active');
                }
            });
        });
        async function changeLanguage(culture) {
            try {
                const response = await fetch('/api/Language/set', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ culture: culture })
                });
                
                if (response.ok) {
                    location.reload();
                } else {
                    console.error('Failed to change language');
                }
            } catch (error) {
                console.error('Error changing language:', error);
            }
        }
    </script>
</body>
</html>